#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
    . "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"

    # source custom completions
    . "${ZDOTDIR:-$HOME}/.zprezto/custom/completions/tmuxinator.zsh"
fi

# Customize to your needs...
alias please="/usr/bin/sudo "
alias grep="grep --color=always"

function sshmount() {

    command -v sshfs || { echo 'sshfs could not be found.' && return 1; }

    sshfs "$1" "$2"                                  \
        -o reconnect                                 \
        -o allow_other                               \
        -o uid=$(id -u)                              \
        -o gid=$(id -g)                              \
        -o idmap=user                                \
        -o IdentityFile=${3:="$HOME/.ssh/id_rsa"}
}

# Mac OS especific
if [[ "$OSTYPE" == darwin* ]]; then

    # Homebrew
    if type brew &> /dev/null; then

        ( brew update && brew upgrade ) &> /dev/null &!

        dest="/usr/local/share/zsh/site-functions/brew_zsh_completion.zsh"
        target="$(brew --prefix)/Library/Contributions/brew_zsh_completion.zsh"

        if [[ ! -h "$dest" ]]; then
            ln -s "$target" "$dest"
        fi
    else
        url="https://raw.githubusercontent.com/Homebrew/install/master/install"
        (
            ruby -e "$(curl -fsSL "$url" )" &> /dev/null;

            dest="/usr/local/share/zsh/site-functions/brew_zsh_completion.zsh"
            target="$(brew --prefix)/Library/Contributions/brew_zsh_completion.zsh"

            if [[ ! -h "$dest" ]]; then
                ln -s "$target" "$dest"
             fi
        ) &!
    fi

    # only if `homebrew` is installed
    if command -v brew >/dev/null 2>&1; then
        # Load rupa's z if installed
        if [ -f $(brew --prefix)/etc/profile.d/z.sh ]; then
            [ -f "$HOME/.z" ] || touch "$HOME/.z"
            . $(brew --prefix)/etc/profile.d/z.sh
        fi
    fi

    # set java home
    export JAVA_HOME=$(/usr/libexec/java_home -v 1.8 2> /dev/null)

    # phpbrew related for mac
    command -v phpbrew &> /dev/null && phpbrew lookup-prefix homebrew > /dev/null 2>&1
fi

# if phpbrew, source
source ~/.phpbrew/bashrc &> /dev/null

# up; will be sourced on the next run
if command -v curl &> /dev/null; then
  if [ -f "$HOME/.config/up/up.sh" ]; then
    . "$HOME/.config/up/up.sh"
  else
    (                                                                       \
      curl --create-dirs -so "$HOME/.config/up/up.sh"                       \
      https://raw.githubusercontent.com/shannonmoeller/up/master/up.sh      \
    ) &!
  fi
fi

# thefuck
command -v thefuck &> /dev/null && eval "$(thefuck --alias)" && unsetopt correct
